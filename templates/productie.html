<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Nieuwe Productie</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; }
        form { display: grid; gap: 10px; }
        label { font-weight: bold; }
        input, select { padding: 8px; font-size: 1em; }
        button { padding: 10px; color: white; border: none; cursor: pointer; }
        a.button { display: inline-block; text-decoration: none; background-color: #6c757d; color: white; padding: 10px 15px; border-radius: 5px; margin-bottom: 20px; }
        #submit-btn { background-color: #28a745; }
        .message { margin-top: 15px; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .success a { color: #155724; font-weight: bold; text-decoration: none; padding: 8px; background-color: #c3e6cb; border-radius: 5px; }
        .error { background-color: #f8d7da; color: #721c24; }
    </style>
<<link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
</head>
<body>
    <a href="/" class="button">‚ùÆ Terug naar Home</a>
    <h1>Nieuwe Productie Starten</h1>
    
    <div id="message-area"></div>

    <form id="productie-form">
        <label for="product_naam">Te produceren product:</label>
        <input type="text" id="product_naam" list="producten-lijst" required>
        <datalist id="producten-lijst">
             {% for product in producten %}
                <option value="{{ product.productnaam }}" data-ref="{{ product.referentie }}"></option>
            {% endfor %}
        </datalist>

        <label for="aantal_eenheden">Aantal eenheden te produceren:</label>
        <input type="number" id="aantal_eenheden" name="aantal_eenheden" required min="1">

        <button type="submit" id="submit-btn">Registreer Productie</button>
    </form>

    <script>
        document.getElementById('productie-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const messageArea = document.getElementById('message-area');
            messageArea.innerHTML = '';
            
            const productName = document.getElementById('product_naam').value;
            const productRefElement = document.querySelector(`#producten-lijst option[value="${productName}"]`);

            if (!productRefElement) {
                alert('Selecteer een geldig product uit de lijst.');
                return;
            }

            const data = {
                referentie: productRefElement.dataset.ref,
                aantal: parseInt(document.getElementById('aantal_eenheden').value, 10)
            };

            const response = await fetch('/api/productie', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');

            if (response.ok) {
                messageDiv.classList.add('success');
                messageDiv.innerHTML = `
                    <p>Productie succesvol geregistreerd!</p>
                    <p>Nieuw lotnummer: <strong>${result.lotnummer}</strong></p>
                    <a href="/api/label/lot/${result.lotnummer}/pdf" target="_blank">Print Label</a>
                `;
                document.getElementById('productie-form').reset();
            } else {
                messageDiv.classList.add('error');
                messageDiv.textContent = `Fout: ${result.message}`;
            }
            messageArea.appendChild(messageDiv);
        });
    </script>
</body>
</html>