<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Winkelverkoop - Traceability App</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; }
        a.button { display: inline-block; text-decoration: none; background-color: #6c757d; color: white; padding: 10px 15px; border-radius: 5px; margin-bottom: 20px; }
        .form-section { padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .message { margin-top: 15px; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <a href="/" class="button">‚ùÆ Terug naar Dashboard</a>
    <h1>Winkelverkoop Registreren</h1>

    <div id="message-area"></div>

    <div class="form-section">
        <form id="verkoop-form">
            <label for="product_naam"><b>Product (Bulk):</b></label>
            <input type="text" id="product_naam" list="producten-lijst" required>
            <datalist id="producten-lijst">
                {% for product in producten %}
                    <option value="{{ product.productnaam }}" data-ref="{{ product.referentie }}"></option>
                {% endfor %}
            </datalist>

            <label for="gewicht_kg"><b>Verkocht Gewicht (kg):</b></label>
            <input type="number" step="0.001" id="gewicht_kg" required>
            
            <button type="submit" style="margin-top: 10px; background-color: #17a2b8; color: white; border: none; padding: 10px;">Verkoop Registreren</button>
        </form>
    </div>

    <script>
        document.getElementById('verkoop-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const messageArea = document.getElementById('message-area');
            messageArea.innerHTML = '';

            const productName = document.getElementById('product_naam').value;
            const productRefElement = document.querySelector(`#producten-lijst option[value="${productName}"]`);

            if (!productRefElement) {
                alert('Selecteer een geldig product uit de lijst.');
                return;
            }

            const data = {
                referentie: productRefElement.dataset.ref,
                gewicht_kg: parseFloat(document.getElementById('gewicht_kg').value)
            };

            const response = await fetch('/api/winkelverkoop', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');

            if (response.ok) {
                messageDiv.classList.add('success');
                messageDiv.textContent = result.message;
                document.getElementById('verkoop-form').reset();
            } else {
                messageDiv.classList.add('error');
                messageDiv.textContent = `Fout: ${result.message}`;
            }
            messageArea.appendChild(messageDiv);
        });
    </script>
</body>
</html>

